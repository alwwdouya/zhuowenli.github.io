<!DOCTYPE html>
<html lang="cn">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

    <link rel="dns-prefetch" href="//disqus.com"/>
    <link rel="dns-prefetch" href="//a.disquscdn.com"/>

    <meta name="Keywords" content="卓文理,前端,前端开发,网页设计,交互设计,svg,effect,loading,css3,javascript"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" />
    
    <meta name="author" content="卓文理">

    <link rel="apple-touch-icon-precomposed" href="/res/img/icon.png">
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-72.png" sizes="72x72" />
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-76.png" sizes="76x76" />
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-114.png" sizes="114x114" />
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-120.png" sizes="120x120" />
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-152.png" sizes="152x152" />
    <link href="/res/img/icon.png" rel="Shortcut Icon" type="image/x-icon"/>

    <title>SVG动画：loading 效果 | 卓文理</title>

    
    <link rel="stylesheet" href="/res/css/style.css">
    <script type="text/javascript" src="/res/js/jquery-2.1.1.min.js"></script>
</head>
<body>
    <div id="container" class="container modify">
        <main id="postPage" class="page post-page post-detail">
                <div class="post-menu">
        <a href="/" class="uplevel">
            <span class="arrow">‹</span>
            <strong class="logo">
                <span class="a">卓</span>
                <span class="b">文</span>
                <span class="c">理</span>
            </strong>
            <h1>前端开发</h1>
        </a>
        <ul class="stats">
            <li>
                <p>本站站长</p>
                <p><a target="_blank" href="http://www.zwlme.com">卓文理</a></p>
            </li>
            <li>
                <p>联系方式</p>
                <p><a target="_blank" href="mailto:531840344@qq.com">531840344@qq.com</a></p>
            </li>
        </ul>
    </div>
            <div class="post-container">
                <div class="article">
                    <a href="/codebase" class="back">
                        <span class="arrow">&lt;</span>
                        <span class="text">返回目录</span>
                    </a>
                    <header class="article-info">
                        <h1>SVG动画：loading 效果</h1>
                    </header>
                    <div class="article-body">
                        <p>上文(<a href="http://www.zwlme.com/codebase/SVGButton.html">SVG动画：弹性按钮</a>)给大家讲了SVG制作弹性按钮。我今天来继续给大家讲讲<a href="http://www.zwlme.com">本站</a>的loading动画是怎么实现的。没错，又是用SVG。</p>

<p>今天我们将教大家如何用SVG，CSS动画以及JavaScript来创建一个简单页面预加载(preloading)效果。对一个网站来说，页面加载是至关重要的，而加载动画则可以让访客在等待中不至于那么无聊。这个教程的效果是源自于<a href="http://fontface.ninja/">Fontface Ninja</a>这个网站。最初在一个页面显示logo图标和一个圆形的进度条，当进度条动画加载完全后，整个<code>div#loading</code>页面向上移动，同时把内容显示出来。</p>

<p>当然，老生常谈的是，这个效果在低版本的浏览器上不支持哟。</p>

<h2>THE HTML</h2>

<p>首先先上html结构：</p>

<p>SVG进度条有两个路径，并且重叠在一起。上面的<code>.ld-loader-circlebg</code>作为背景使用，而<code>.ld-loader-circle</code>则是用来显示加载的进度值。</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"container"</span> <span class="na">class=</span><span class="s">"container modify"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"loading"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"ld-logo"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">"ld-inner"</span> <span class="na">viewBox=</span><span class="s">"0 0 612 792"</span> <span class="na">enable-background=</span><span class="s">"new 0 0 612 792"</span> <span class="na">xml:space=</span><span class="s">"preserve"</span> <span class="na">style=</span><span class="s">"height:250px;"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;polyline</span> <span class="na">fill=</span><span class="s">"#39A239"</span> <span class="na">points=</span><span class="s">"506.6,217.5 171,217.5 171,241.7 395.1,241.7 141.7,523.7 171,523.7 431.6,241.7 506.6,241.8 506.6,258.2 260.8,523.7 268.1,523.7 461.8,523.7 461.8,596.6 126.2,596.6 126.2,620.7 484.2,620.7 484.6,523.9 506.6,523.7 506.6,645.1 103.8,645.1 103.8,572.9 439.4,572.9 439.4,548.3 216,548.3 209.5,548.3 469.8,265.8 439.4,265.8 178.3,548.3 103.6,548.3 103.6,532.5 350.7,265.8 149,265.8 149,193.2 484.2,193.2 484.1,168.7 126.2,168.7 126.2,265.8 103.4,265.8 103.4,145 506.6,145 "</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/svg&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"ld-loader"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">"ld-inner"</span> <span class="na">width=</span><span class="s">"60px"</span> <span class="na">height=</span><span class="s">"60px"</span> <span class="na">viewBox=</span><span class="s">"0 0 80 80"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;path</span> <span class="na">class=</span><span class="s">"ld-loader-circlebg"</span> <span class="na">d=</span><span class="s">"M40,10C57.351,10,71,23.649,71,40.5S57.351,71,40.5,71 S10,57.351,10,40.5S23.649,10,40.5,10z"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;path</span> <span class="na">id=</span><span class="s">"ld-loader-circle"</span> <span class="na">class=</span><span class="s">"ld-loader-circle"</span> <span class="na">d=</span><span class="s">"M40,10C57.351,10,71,23.649,71,40.5S57.351,71,40.5,71 S10,57.351,10,40.5S23.649,10,40.5,10z"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/svg&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span> <span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- more content --&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h1>THE SCSS</h1>

<p>我们希望加载页面能够充满整个页面。所以给他一个100%的宽度，并且<code>position: fixed;</code>。</p>

<p><em>下面是<a href="http://www.sass-lang.com/">SCSS</a>的代码，你所看到的<code>@include</code>等等是我定义好的方法，如批量添加加<code>-webkit-</code>,<code>-moz-</code>等浏览器前缀的方法等等。</em></p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nf">#loading</span><span class="p">{</span>
    <span class="nl">position</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
    <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="nl">z-index</span><span class="p">:</span> <span class="m">8000</span><span class="p">;</span>
    <span class="nl">min-height</span><span class="p">:</span> <span class="m">480px</span><span class="p">;</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
    <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
    <span class="nl">background</span><span class="p">:</span> <span class="m">#f1f1f1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>设置logo和进度条的位置。我们使用百分比来设置居中和高度。因为我们可能不知道logo的大小。</p>
<div class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="c1">//scss
</span><span class="nc">.ld-logo</span><span class="o">,</span><span class="nc">.ld-loader</span><span class="p">{</span>
    <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
    <span class="nl">left</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
    <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="nl">cursor</span><span class="p">:</span> <span class="nb">default</span><span class="p">;</span>
    <span class="nt">pointer-events</span><span class="nd">:none</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.ld-logo</span><span class="p">{</span>
    <span class="k">@include</span> <span class="nd">inline-block</span><span class="p">;</span>
    <span class="nl">top</span><span class="p">:</span> <span class="m">40%</span><span class="p">;</span>
    <span class="k">@include</span> <span class="nd">transform</span><span class="p">(</span><span class="nf">translate3d</span><span class="p">(</span><span class="m">-50%</span><span class="o">,-</span><span class="m">50%</span><span class="o">,</span><span class="m">0</span><span class="p">));</span>
    <span class="k">@include</span> <span class="nd">transition</span><span class="p">(</span><span class="n">opacity</span> <span class="m">0</span><span class="mi">.3s</span> <span class="nf">cubic-bezier</span><span class="p">(</span><span class="m">0</span><span class="mi">.7</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">));</span>
<span class="p">}</span>
<span class="nc">.ld-loader</span><span class="p">{</span>
    <span class="nl">bottom</span><span class="p">:</span> <span class="m">20%</span><span class="p">;</span>
    <span class="k">@include</span> <span class="nd">transform</span><span class="p">(</span><span class="nf">translate3d</span><span class="p">(</span><span class="m">-50%</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>SVG我们给他一个<code>ld-inner</code>的class，让他成为块级元素，并且水平居中。</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.ld-inner</span><span class="p">{</span>
    <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
    <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>SVG进度条默认不要填充颜色，设置<code>stroke-width</code>为6，底层的颜色是<code>#ddd</code>，顶层的颜色为<code>#39A239</code>，然后给<code>.ld-loader-circle</code>的<code>stroke-dashoffset</code>添加一个<code>0.2s</code>过渡动画。</p>

<ul>
<li><code>fill</code>: 填充颜色用</li>
<li><code>stroke</code>: 轮廓，可以理解为类似边框</li>
</ul>
<div class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="c1">// scss
</span><span class="nc">.ld-loader</span> <span class="nt">svg</span> <span class="nt">path</span><span class="p">{</span>
    <span class="nt">fill</span><span class="nd">:none</span><span class="p">;</span>
    <span class="na">stroke-width</span><span class="p">:</span> <span class="m">6</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nc">.ld-loader-circlebg</span><span class="p">{</span>
        <span class="na">stroke</span><span class="p">:</span> <span class="mh">#ddd</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">&amp;</span><span class="nc">.ld-loader-circle</span><span class="p">{</span>
        <span class="k">@include</span> <span class="nd">transition</span><span class="p">(</span><span class="n">stroke-dashoffset</span> <span class="m">0</span><span class="mi">.2s</span><span class="p">);</span>
        <span class="na">stroke</span><span class="p">:</span> <span class="mh">#39A239</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>动画加载中，也就是首次打开页面时的动画效果。</p>
<div class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="c1">// scss
</span><span class="nc">.loading</span><span class="p">{</span>
    <span class="nc">.ld-logo</span><span class="o">,</span><span class="nc">.ld-loader</span><span class="p">{</span>
        <span class="nl">opacity</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nc">.ld-logo</span><span class="p">{</span>
        <span class="k">@include</span> <span class="nd">animation</span><span class="p">(</span><span class="n">animInitialLogo</span> <span class="m">0</span><span class="mi">.5s</span> <span class="nf">cubic-bezier</span><span class="p">(</span><span class="m">0</span><span class="mi">.7</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">)</span> <span class="nb">both</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nc">.ld-loader</span><span class="p">{</span>
        <span class="k">@include</span> <span class="nd">animation</span><span class="p">(</span><span class="n">animInitialLoader</span> <span class="m">0</span><span class="mi">.5s</span> <span class="nf">cubic-bezier</span><span class="p">(</span><span class="m">0</span><span class="mi">.7</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">)</span> <span class="nb">both</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>上面既然使用了<code>animation</code>动画，那么接下来就是<code>keyframes</code>这个帧动画出马了。</p>
<div class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="c1">// scss
// 初始化logo动画
</span><span class="k">@include</span> <span class="nd">keyframes</span><span class="p">(</span><span class="n">animInitialLogo</span><span class="p">){</span>
    <span class="nt">from</span> <span class="p">{</span> <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// logo结束动画
</span><span class="k">@include</span> <span class="nd">keyframes</span><span class="p">(</span><span class="n">animLoadedLogo</span><span class="p">){</span>
    <span class="nt">to</span><span class="p">{</span>
        <span class="k">@include</span> <span class="nd">transform</span><span class="p">(</span><span class="nf">translate3d</span><span class="p">(</span><span class="m">-50%</span><span class="o">,</span><span class="m">100%</span><span class="o">,</span><span class="m">0</span><span class="p">)</span> <span class="nf">translate3d</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">50px</span><span class="o">,</span><span class="m">0</span><span class="p">)</span> <span class="nf">scale3d</span><span class="p">(</span><span class="m">0</span><span class="mi">.65</span><span class="o">,</span><span class="m">0</span><span class="mi">.65</span><span class="o">,</span><span class="m">1</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 初始化loader动画
</span><span class="k">@include</span> <span class="nd">keyframes</span><span class="p">(</span><span class="n">animInitialLoader</span><span class="p">){</span>
    <span class="nt">from</span><span class="p">{</span>
        <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">@include</span> <span class="nd">transform</span><span class="p">(</span><span class="nf">translate3d</span><span class="p">(</span><span class="m">-50%</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="p">)</span> <span class="nf">scale3d</span><span class="p">(</span><span class="m">0</span><span class="mi">.5</span><span class="o">,</span><span class="m">0</span><span class="mi">.5</span><span class="o">,</span><span class="m">1</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// loader结束动画
</span><span class="k">@include</span> <span class="nd">keyframes</span><span class="p">(</span><span class="n">animLoadedLoader</span><span class="p">){</span>
    <span class="nt">to</span><span class="p">{</span>
        <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">@include</span> <span class="nd">transform</span><span class="p">(</span><span class="nf">translate3d</span><span class="p">(</span><span class="m">-50%</span><span class="o">,-</span><span class="m">100%</span><span class="o">,</span><span class="m">0</span><span class="p">)</span> <span class="nf">scale3d</span><span class="p">(</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 隐藏至头部的动画
</span><span class="k">@include</span> <span class="nd">keyframes</span><span class="p">(</span><span class="n">animLoadedHeader</span><span class="p">){</span>
    <span class="nt">to</span><span class="p">{</span>
        <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">@include</span> <span class="nd">transform</span><span class="p">(</span><span class="nf">translate3d</span><span class="p">(</span><span class="m">0</span><span class="o">,-</span><span class="m">100%</span><span class="o">,</span><span class="m">0</span><span class="p">)</span> <span class="nf">scale3d</span><span class="p">(</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 显示内容
</span><span class="k">@include</span> <span class="nd">keyframes</span><span class="p">(</span><span class="n">animLoadedContent</span><span class="p">){</span>
    <span class="nt">from</span><span class="p">{</span>
        <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">@include</span> <span class="nd">transform</span><span class="p">(</span><span class="nf">scale3d</span><span class="p">(</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// scss的`%placeholders`占位符，可以用`@extend`来继承这个内容
</span><span class="nv">%animLoadedContent</span><span class="p">{</span>
    <span class="k">@include</span> <span class="nd">animation</span><span class="p">(</span><span class="n">animLoadedContent</span> <span class="m">1s</span> <span class="nf">cubic-bezier</span><span class="p">(</span><span class="m">0</span><span class="mi">.7</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">)</span> <span class="nb">both</span><span class="p">);</span>
    <span class="k">@include</span> <span class="nd">transition-delay</span><span class="p">(</span><span class="m">0</span><span class="mi">.15s</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>loading加载完成后，就需要把logo跟loader隐藏掉。并且把<code>#loading</code>这个loading页面向上隐藏掉，同时把正文内容从下往上显示出来。</p>
<div class="highlight"><pre><code class="language-scss" data-lang="scss"><span class="c1">// scss
</span><span class="nc">.loaded</span><span class="p">{</span>
    <span class="nc">.content</span> <span class="p">{</span>
        <span class="nc">.article</span><span class="p">{</span>
            <span class="k">@extend</span> <span class="nv">%animLoadedContent</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.header</span> <span class="nt">h1</span><span class="o">,</span><span class="nc">.post-header</span> <span class="nt">h1</span><span class="p">{</span>
            <span class="k">@extend</span> <span class="nv">%animLoadedContent</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.header</span> <span class="nt">h2</span><span class="p">{</span>
            <span class="k">@extend</span> <span class="nv">%animLoadedContent</span><span class="p">;</span>
            <span class="nl">line-height</span><span class="p">:</span> <span class="m">1</span><span class="mi">.5</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nn">#loading</span><span class="p">{</span>
        <span class="k">@include</span> <span class="nd">animation</span><span class="p">(</span><span class="n">animLoadedHeader</span> <span class="m">1s</span> <span class="nf">cubic-bezier</span><span class="p">(</span><span class="m">0</span><span class="mi">.7</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">)</span> <span class="n">forwards</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nc">.ld-logo</span><span class="o">,</span><span class="nc">.ld-loader</span><span class="p">{</span>
        <span class="nl">opacity</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nc">.ld-logo</span><span class="p">{</span>
        <span class="k">@include</span> <span class="nd">transform-origin</span><span class="p">(</span><span class="m">50%</span> <span class="m">0</span><span class="p">);</span>
        <span class="k">@include</span> <span class="nd">animation</span><span class="p">(</span><span class="n">animLoadedLogo</span> <span class="m">1s</span> <span class="nf">cubic-bezier</span><span class="p">(</span><span class="m">0</span><span class="mi">.7</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">)</span> <span class="n">forwards</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nc">.ld-loader</span><span class="p">{</span>
        <span class="k">@include</span> <span class="nd">animation</span><span class="p">(</span><span class="n">animLoadedLoader</span> <span class="m">1s</span> <span class="nf">cubic-bezier</span><span class="p">(</span><span class="m">0</span><span class="mi">.7</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="mi">.3</span><span class="o">,</span><span class="m">1</span><span class="p">)</span> <span class="n">forwards</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2>THE JAVASCRIPT</h2>

<p>该JavaScript由两部分组成，公共的路径加载动画操作，以及另一个具体的<code>element</code>加载操作。</p>

<p>首先把这个加载动画文件命名为pathLoader.js。</p>

<p>我们希望<code>stroke-dashoffset</code>能够以动画的形式来填充路径。</p>

<p>首先，设置<code>stroke-dashoffset</code>的长度为路径的长度(<code>getTotalLength()</code>)。然后我们让<code>stroke-dasharray</code>的值慢慢变小，直到0为止。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="kd">function</span> <span class="nx">PathLoader</span><span class="p">(</span><span class="nx">el</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">el</span><span class="p">;</span>
        <span class="c1">// clear stroke</span>
        <span class="c1">// svg stroke属性，getTotalLength() 返回svg线条长度</span>
        <span class="c1">// stroke-dasharray  是指定画出的线段每段的长度</span>
        <span class="c1">// stroke-dashoffset 是指定每个小段的起始偏移量。</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDasharray</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDashoffset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">PathLoader</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">strokeDashoffset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">getTotalLength</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">val</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">PathLoader</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setProgress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_draw</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s1">'function'</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 设置延时，使得最后的加载进度条动画效果可见。</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
        <span class="p">};</span>
    <span class="p">};</span>

    <span class="nx">PathLoader</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setProgressFn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fn</span> <span class="o">===</span> <span class="s1">'function'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">};</span>
    <span class="p">};</span>

    <span class="c1">// 添加到全局命名空间</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">PathLoader</span> <span class="o">=</span> <span class="nx">PathLoader</span><span class="p">;</span>
</code></pre></div>
<p>该<code>setProgressFn</code>方法可以用来自定义一个交互效果。</p>

<p>例如，对于我们的演示我们没有使用任何预加载，而是模拟一个加载动画，设置0和1之间的随机值来设置时间间隔：</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">startLoading</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">simulationFn</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">progress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">instance</span><span class="p">.</span><span class="nx">setProgress</span><span class="p">(</span><span class="nx">progress</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s2">"interactive"</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s2">"loading"</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">progress</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">progress</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="nx">instance</span><span class="p">.</span><span class="nx">setProgress</span><span class="p">(</span><span class="nx">progress</span><span class="p">);</span>
                    <span class="nx">PageLoaded</span><span class="p">(</span><span class="nx">progress</span><span class="p">,</span><span class="nx">interval</span><span class="p">);</span>
                <span class="p">};</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s2">"complete"</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s2">"Loaded"</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">progress</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">progress</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="nx">PageLoaded</span><span class="p">(</span><span class="nx">progress</span><span class="p">,</span><span class="nx">interval</span><span class="p">);</span>
                <span class="p">};</span>
            <span class="p">},</span><span class="mi">80</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">loader</span><span class="p">.</span><span class="nx">setProgressFn</span><span class="p">(</span><span class="nx">simulationFn</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>接下来，我们将这个文件命名为pageLoading.js，首先，我们先初始化和缓存一些变量。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'container'</span><span class="p">),</span>
    <span class="nx">loading</span>   <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'loading'</span><span class="p">),</span>
    <span class="nx">loader</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">PathLoader</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'ld-loader-circle'</span><span class="p">));</span>
</code></pre></div>
<p>当loading动画正在加载的时候，需要阻止页面滚动。并且给<code>.container</code>添加一个<code>loading</code>的class。然后执行上方的<code>startLoading()</code>方法。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'scroll'</span><span class="p">,</span><span class="nx">disableScroll</span><span class="p">);</span>
    <span class="nx">classie</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span><span class="s1">'loading'</span><span class="p">);</span>
    <span class="nx">startLoading</span><span class="p">();</span>
<span class="p">}</span>
<span class="c1">// 阻止滚动</span>
<span class="kd">function</span> <span class="nx">disableScroll</span><span class="p">(){</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>执行<code>PageLoaded()</code>。当<code>progress</code>为1的时候，页面加载完成。</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 页面加载完成</span>
<span class="kd">function</span> <span class="nx">PageLoaded</span><span class="p">(</span><span class="nx">progress</span><span class="p">,</span><span class="nx">interval</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">progress</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">classie</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span><span class="s1">'loading'</span><span class="p">);</span>
        <span class="nx">classie</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span><span class="s1">'loaded'</span><span class="p">);</span>
        <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">onEndHeaderAnimation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">){</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">'scroll'</span><span class="p">,</span><span class="nx">disableScroll</span><span class="p">);</span>
            <span class="nx">classie</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="s1">'layout-switch'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">onEndHeaderAnimation</span><span class="p">();</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>That&#39;s all. 具体效果可以查看<a href="http://www.zwlme.com/codebase/SVGLoading">DEMO</a>。</p>

<p>有任何疑问都可以在下方留言。</p>

<p>谢谢！</p>

<hr>

<p><br></p>

<p>相关文章</p>

<blockquote>
<p><a href="http://www.zwlme.com/codebase/SVGButton.html">SVG动画：弹性按钮</a></p>

<p>SVG动画：loading 效果</p>
</blockquote>

                    </div>
                </div>
                <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'zhuowenli'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
                        <footer class="footer">
            <p class="copyright">© 2015 卓文理 · <a href="/about/" class="about">关于本站</a> · Powered by <a href="http://github.com" class="powered">GitHub</a> &amp; <a href="http://jekyllcn.com" class="powered">Jekyll</a></p>
        </footer>
            </div>
            <div class="post-backdrop"></div>
        </main>

        <script type="text/javascript" src="/res/js/index.js"></script>
        <script type="text/javascript">
            app.init();
        </script>
    </div>
</body>
</html>