<!DOCTYPE html>
<html lang="cn">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

    <link rel="dns-prefetch" href="//disqus.com"/>
    <link rel="dns-prefetch" href="//a.disquscdn.com"/>

    <meta name="Keywords" content="卓文理,前端,前端开发,网页设计,交互设计,css,css3,animation,performance"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta content="telephone=no" name="format-detection" />
    
    <meta name="author" content="卓文理">

    <link rel="apple-touch-icon-precomposed" href="/res/img/icon.png">
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-72.png" sizes="72x72" />
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-76.png" sizes="76x76" />
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-114.png" sizes="114x114" />
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-120.png" sizes="120x120" />
    <link rel="apple-touch-icon-precomposed" href="/res/img/icon-152.png" sizes="152x152" />
    <link href="/res/img/icon.png" rel="Shortcut Icon" type="image/x-icon"/>

    <title>构建高性能CSS3动画 | 卓文理</title>

    
    <link rel="stylesheet" href="/res/css/style.css">
    <script type="text/javascript" src="/res/js/jquery-2.1.1.min.js"></script>
</head>
<body>
    <div id="container" class="container modify">
        <main id="postPage" class="page post-page post-detail">
                <div class="post-menu">
        <a href="/" class="uplevel">
            <span class="arrow">‹</span>
            <strong class="logo">
                <span class="a">卓</span>
                <span class="b">文</span>
                <span class="c">理</span>
            </strong>
            <h1>前端开发</h1>
        </a>
        <ul class="stats">
            <li>
                <p>本站站长</p>
                <p><a target="_blank" href="http://www.zwlme.com">卓文理</a></p>
            </li>
            <li>
                <p>联系方式</p>
                <p><a target="_blank" href="mailto:531840344@qq.com">531840344@qq.com</a></p>
            </li>
        </ul>
    </div>
            <div class="post-container">
                <div class="article">
                    <a href="/frontend" class="back">
                        <span class="arrow">&lt;</span>
                        <span class="text">返回目录</span>
                    </a>
                    <header class="article-info">
                        <h1>构建高性能CSS3动画</h1>
                    </header>
                    <div class="article-body">
                        <p>高性能移动Web相较PC的场景需要考虑的因素也相对更多更复杂，我们总结为以下几点： 流量、功耗与流畅度。 </p>

<p>在PC时代我们更多的是考虑体验上的流畅度，而在Mobile端本身丰富的场景下，需要额外关注对用户基站网络流量使用的情况，设备耗电量的情况。</p>

<p>关于流畅度，主要体现在前端动画中，在现有的前端动画体系中，通常有两种模式：JS动画与CSS3动画。 </p>

<p>JS动画是通过JS动态改写样式实现动画能力的一种方案，在PC端兼容低端浏览器中不失为一种推荐方案。</p>

<p>而在移动端，我们选择性能更优浏览器原生实现方案：CSS3动画。</p>

<p>然而，CSS3动画在移动多终端设备场景下，相比PC会面对更多的性能问题，主要体现在动画的卡顿与闪烁。</p>

<p>目前对提升移动端CSS3动画体验的主要方法有几点：</p>

<h2>尽可能多的利用硬件能力，如使用3D变形来开启GPU加速</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">-webkit-transform</span><span class="o">:</span> <span class="nt">translate3d</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">);</span>
<span class="nt">-moz-transform</span><span class="o">:</span> <span class="nt">translate3d</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">);</span>
<span class="nt">-ms-transform</span><span class="o">:</span> <span class="nt">translate3d</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">);</span>
<span class="nt">transform</span><span class="o">:</span> <span class="nt">translate3d</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">,</span> <span class="nt">0</span><span class="o">);</span>
</code></pre></div>
<p>如动画过程有闪烁（通常发生在动画开始的时候），可以尝试下面的Hack：</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">-webkit-backface-visibility</span><span class="o">:</span> <span class="nt">hidden</span><span class="o">;</span>
<span class="nt">-moz-backface-visibility</span><span class="o">:</span> <span class="nt">hidden</span><span class="o">;</span>
<span class="nt">-ms-backface-visibility</span><span class="o">:</span> <span class="nt">hidden</span><span class="o">;</span>
<span class="nt">backface-visibility</span><span class="o">:</span> <span class="nt">hidden</span><span class="o">;</span>

<span class="nt">-webkit-perspective</span><span class="o">:</span> <span class="nt">1000</span><span class="o">;</span>
<span class="nt">-moz-perspective</span><span class="o">:</span> <span class="nt">1000</span><span class="o">;</span>
<span class="nt">-ms-perspective</span><span class="o">:</span> <span class="nt">1000</span><span class="o">;</span>
<span class="nt">perspective</span><span class="o">:</span> <span class="nt">1000</span><span class="o">;</span>
</code></pre></div>
<p>如下面一个元素通过<code>translate3d</code>右移<code>500px</code>的动画流畅度会明显优于使用<code>left</code>属性：</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nf">#ball-1</span> <span class="p">{</span>
  <span class="n">transition</span><span class="o">:</span> <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transform</span> <span class="m">.5s</span> <span class="n">ease</span><span class="p">;</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transform</span><span class="o">:</span> <span class="n">translate3d</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="p">);</span>
<span class="p">}</span>
<span class="nf">#ball-1</span><span class="nc">.slidein</span> <span class="p">{</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transform</span><span class="o">:</span> <span class="n">translate3d</span><span class="p">(</span><span class="m">500px</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="p">);</span>
<span class="p">}</span>


<span class="nf">#ball-2</span> <span class="p">{</span>
  <span class="n">transition</span><span class="o">:</span> <span class="k">left</span> <span class="m">.5s</span> <span class="n">ease</span><span class="p">;</span>
  <span class="k">left</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#ball-2</span><span class="nc">.slidein</span> <span class="p">{</span>
  <span class="k">left</span><span class="o">:</span> <span class="m">500px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>注：3D变形会消耗更多的内存与功耗，应确实有性能问题时才去使用它，兼在权衡</p>

<h3>动画实践</h3>

<ul>
<li><p>CSS动画属性会触发整个页面的重排<code>relayout</code>、重绘<code>repaint</code>、重组<code>recomposite</code></p></li>
<li><p>Paint通常是其中最花费性能的，尽可能避免使用触发paint的CSS动画属性，这也是为什么我们推荐在CSS动画中使用<code>webkit-transform: translateX(3em)</code>的方案代替使用<code>left: 3em</code>，因为left会额外触发layout与paint，而<code>webkit-transform</code>只触发整个页面composite</p></li>
</ul>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">div</span> <span class="p">{</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">animation</span><span class="o">-</span><span class="n">duration</span><span class="o">:</span> <span class="m">5s</span><span class="p">;</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">animation</span><span class="o">-</span><span class="n">name</span><span class="o">:</span> <span class="n">move</span><span class="p">;</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">animation</span><span class="o">-</span><span class="n">iteration</span><span class="o">-</span><span class="n">count</span><span class="o">:</span> <span class="n">infinite</span><span class="p">;</span>
  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">animation</span><span class="o">-</span><span class="k">direction</span><span class="o">:</span> <span class="n">alternate</span><span class="p">;</span>
  <span class="k">width</span><span class="o">:</span> <span class="m">200px</span><span class="p">;</span>
  <span class="k">height</span><span class="o">:</span> <span class="m">200px</span><span class="p">;</span>
  <span class="k">margin</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
  <span class="k">background-color</span><span class="o">:</span> <span class="m">#808080</span><span class="p">;</span>
  <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-css" data-lang="css"><span class="k">@-webkit-keyframes</span> <span class="nt">move</span><span class="p">{</span>
    <span class="nt">from</span> <span class="p">{</span>
        <span class="k">left</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nt">to</span> <span class="p">{</span>
        <span class="k">left</span><span class="o">:</span> <span class="m">200px</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>如下图使用<code>left</code>将持续触发页面重绘，表现为红色边框：</p>

<p><img src="https://camo.githubusercontent.com/654764ba444aec1ecf9252045a3d28017848791d/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f3637373131342f313735353536312f61386662396339342d363636362d313165332d383738382d6163356235656634656632342e676966" alt=""></p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="k">@-webkit-keyframes</span> <span class="nt">move</span><span class="p">{</span>
    <span class="nt">from</span> <span class="p">{</span>
        <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transform</span><span class="o">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">100px</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nt">to</span> <span class="p">{</span>
        <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transform</span><span class="o">:</span> <span class="n">translateX</span><span class="p">(</span><span class="m">200px</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>如下图使用<code>-webkit-transform</code>页面只发生重组，表现为橙色边框：</p>

<p><img src="https://camo.githubusercontent.com/8e251fb2c0aa600041b8d28e881472990c84745c/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f3637373131342f313735353536322f61616566323632652d363636362d313165332d386538332d3365373730663236396166302e676966" alt=""></p>

<p>CSS属性在CSS动画中行为表:</p>

<p><img src="https://camo.githubusercontent.com/9a7812cd5a327c5384eea3d3c33aa875543aef56/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f3637373131342f313735323338332f31663863356538652d363631632d313165332d393732352d3330366637653563373366352e706e67" alt=""></p>

<h2>尽可能少的使用box-shadows与gradients</h2>

<p><code>box-shadows</code>与<code>gradients</code>往往都是页面的性能杀手，尤其是在一个元素同时都使用了它们，所以拥抱扁平化设计吧。</p>

<h2>尽可能的让动画元素不在文档流中，以减少重排</h2>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">position</span><span class="o">:</span> <span class="nt">fixed</span><span class="o">;</span>
<span class="nt">position</span><span class="o">:</span> <span class="nt">absolute</span><span class="o">;</span>
</code></pre></div>
<p>原文：<a href="https://github.com/AlloyTeam/Mars/blob/master/performance/high-performance-css3-animation.md">高性能 CSS3 动画</a></p>

<p>作者：<a href="https://github.com/yuanyan">元彦</a></p>

                    </div>
                </div>
                <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'zhuowenli'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
                        <footer class="footer">
            <p class="copyright">© 2015 卓文理 · <a href="/about/" class="about">关于本站</a> · Powered by <a href="http://github.com" class="powered">GitHub</a> &amp; <a href="http://jekyllcn.com" class="powered">Jekyll</a></p>
        </footer>
            </div>
            <div class="post-backdrop"></div>
        </main>

        <script type="text/javascript" src="/res/js/index.js"></script>
        <script type="text/javascript">
            app.init();
        </script>
    </div>
</body>
</html>